{% extends 'base.html' %}
{% block title %}Productos - Talcahualme{% endblock %}

{% block content %}
<!-- Hero Section -->
<section class="hero-dark text-white py-5 mb-5 position-relative overflow-hidden">
    <div class="container text-center">
        <!-- Badge "Nueva Colección" -->
        <span class="etiqueta-nueva">
            <span class="punto"></span>Nueva Colección 2026
        </span>
        <h1 class="display-3 fw-black mb-4">Viste la Tradición<br><span class="texto-inovacion">Siente la Innovación</span></h1>
        <p class="lead w-75 mx-auto mb-5 opacity-90">Ropa artesanal hecha a mano con materiales naturales. Cada pieza cuenta una historia única.</p>
        <a href="#catalogo" class="btn btn-explorar">
            <span class="material-symbols-outlined">shopping_bag</span>Explorar Colección
        </a>
    </div>
</section>

<!-- Catálogo Section -->
<div id="catalogo" class="container py-5">
    <!-- Header con filtros -->
    <div class="row align-items-end mb-5">
        <div class="col-md-8">
            <h1 class="display-4 fw-bold mb-2">Nuestro Catálogo</h1>
            <p class="text-muted lead">Descubre piezas únicas tejidas con pasión.</p>
        </div>
    </div>
    
    <!-- Chips Filtros -->
    <div class="chips-scroll pb-3 mb-5">
        <h3 class="footer-section mb-3">Categorias</h3>
        <div class="d-flex gap-2 flex-nowrap"><!-- Colocamos el #catalogo para que nos lleve a la sección de productos (el #catalogo debe estar pegado con la llave } (}#catalogo))--> 
            <a href=" {% url 'productList' %}#catalogo" class="badge bg-light text-dark border border-secondary-subtle px-4 py-2 fw-medium text-decoration-none rounded-pill chip-filtro
                    {% if not categoria_seleccionada %}chip-activo{% endif %}">
                Todos
            </a>
            {% for categoria in categorias %}<!-- Colocamos el #Catalogo para que nos lleve a la seccion de productos pero con el id de la categoria -->
            <a href="{% url 'productList' %}?categoria={{ categoria.id }}#catalogo " class="badge bg-light text-dark border border-secondary-subtle px-4 py-2 fw-medium text-decoration-none rounded-pill chip-filtro 
                    {% if categoria_seleccionada.id == categoria.id %}chip-activo{% endif %}">
                {{ categoria.nombreCategoria }}
            </a>
            {% endfor %}
        </div>
    </div>
    
    <!-- Grid Productos -->
    <div class="row g-4">
        {% for producto in productos %}
        <div class="col-xl-3 col-lg-4 col-md-6">
            <div class="card h-100 card-hover border-0 shadow-sm rounded-4 overflow-hidden position-relative">
                <!-- Imagen con zoom hover -->
                <div class="position-relative overflow-hidden imagen-container-fixed">
                    {% if producto.imagen %}
                    <img src="{{ producto.imagen.url }}" 
                        class="card-img-top w-100 h-100 object-fit-cover imagen-zoom-suave"
                        alt="{{ producto.nombre }}">
                    {% else %}
                    <img src="https://via.placeholder.com/400x280?text=Sin+Imagen" 
                         class="card-img-top w-100 h-100 object-fit-cover">
                    {% endif %}
                    
                    <!-- Badge lana -->
                    {% if producto.categoria.all|length > 0 %}
                        {% for cat in producto.categoria.all%}
                            {% if cat.nombreCategoria == 'Lana' %}
                                <span class="position-absolute top-3 end-3 badge bg-primary fs-2-xs px-3 py-2 rounded-pill fw-bold">Lana 100%</span>
                            {% endif %}
                        {% endfor %}
                    {% endif %}
                    <!-- Badge agotado -->
                    {% if producto.stockProducto == 0 %}
                    <div class="position-absolute top-0 start-0 w-100 h-100 bg-dark bg-opacity-50 d-flex align-items-center justify-content-center">
                        <span class="badge bg-secondary fs-2-xs px-4 py-3 rounded-pill">Agotado</span>
                    </div>
                    {% endif %}
                </div>
                
                <!-- Body card -->
                <div class="card-body d-flex flex-column p-4">
                    <div class="d-flex justify-content-between align-items-start mb-3">
                        <h5 class="card-title fw-bold mb-0 titulo-card-compacto">{{ producto.nombre }}</h5>
                        <span class="span-precio">${{ producto.precio|floatformat:0 }} MXN</span>
                    </div>
                    <p class="text-muted flex-grow-1 mb-4 descripcion-clamp">
                        {{ producto.descripcion }}
                    </p>
                    {% if producto.stockProducto > 0 %} <!--Implementacion de un modal para mostrar los detalles del producto-->
                    <a class="btn btn-light text-muted w-100 fw-bold mt-auto modal-trigger"
                    data-imagen="{% if producto.imagen %}{{ producto.imagen.url }}{% else %}https://via.placeholder.com/400x280?text=Sin+Imagen{% endif %}"
                    data-titulo="{{ producto.nombre }}"
                    data-precio="$ {{ producto.precio|floatformat:0 }} MXN"
                    data-categoria="{% for cat in producto.categoria.all %}{{ cat.nombreCategoria }}{% if not forloop.last %}, {% endif %}{% endfor %}"
                    data-tallas="{% for t in producto.tallaDisponible.all %}{{ t.nombreTalla }}{% if not forloop.last %}, {% endif %}{% endfor %}"
                    data-materiales="{% for m in producto.tipoMateria.all %}{{ m.nombreTipoMateria }}{% if not forloop.last %}, {% endif %}{% endfor %}"
                    data-cuidados="{% for c in producto.instruccionesCuidado.all %}{{ c.nombre }}{% if not forloop.last %} | {% endif %}{% endfor %}"
                    data-stock="{{ producto.stock_disponible }}"
                    data-producto-id="{{ producto.id }}"
                    data-descripcion="{{ producto.descripcion|truncatewords:20 }}">
                        Ver Detalles
                    </a>
                    {% else %}
                    <button class="btn btn-light text-muted w-100 fw-bold mt-auto modal-trigger" 
                    data-imagen="{% if producto.imagen %}{{ producto.imagen.url }}{% else %}https://via.placeholder.com/400x280?text=Sin+Imagen{% endif %}"
                    data-titulo="{{ producto.nombre }}"
                    data-precio="$ {{ producto.precio|floatformat:0 }} MXN"
                    data-categoria="{% for cat in producto.categoria.all %}{{ cat.nombreCategoria }}{% if not forloop.last %}, {% endif %}{% endfor %}"
                    data-tallas="{% for t in producto.tallaDisponible.all %}{{ t.nombreTalla }}{% if not forloop.last %}, {% endif %}{% endfor %}"
                    data-materiales="{% for m in producto.tipoMateria.all %}{{ m.nombreTipoMateria }}{% if not forloop.last %}, {% endif %}{% endfor %}"
                    data-cuidados="{% for c in producto.instruccionesCuidado.all %}{{ c.nombre }}{% if not forloop.last %} | {% endif %}{% endfor %}"
                    data-stock="{{ producto.stock_disponible }}"
                    data-producto-id="{{ producto.id }}"
                    data-descripcion="{{ producto.descripcion|truncatewords:20 }}">
                        Ver Detalles
                    </button>
                    {% endif %}
                </div>
            </div>
        </div>
        {% empty %}
        <!-- PRODUCTOS VACÍOS - SIN MESSAGES -->
        <div class="col-12">
            <div class="text-center py-5">
                <!-- SI NO HAY messages, mensaje genérico -->
                <div class="alert alert-warning mb-4">
                    <h3 class="mb-3">No hay productos disponibles</h3>
                    <p class="text-muted mb-0">¡Pronto tendremos novedades para ti!</p>
                </div>
                    
                <!-- Botón CTA -->
                <a href="{% url 'tienda' %}" class="btn btn-explorar mt-4">
                    <span class="material-symbols-outlined me-2">store</span>
                    Volver a Inicio
                </a>
            </div>
        </div>
        {% endfor %}
    </div>
    
    <!-- Botón "Ver todo" -->
    <div class="text-center mt-5">
        <button class="btn btn-outline-secondary btn-lg px-5 py-3 fw-bold rounded-pill">
            Ver todo el catálogo
            <span class="material-symbols-outlined ms-2">arrow_downward</span>
        </button>
    </div>
</div>
{% endblock %}
